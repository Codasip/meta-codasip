From 6c298520d9d75a66fc6dc1c299bf66be329c8d87 Mon Sep 17 00:00:00 2001
From: Samuel Obuch <samuel.obuch@codasip.com>
Date: Sat, 2 Mar 2024 00:42:59 +0100
Subject: [PATCH 07/15] riscv: hobgoblin: add configuration for gpio-restart

Enables reboot command, tested on genesys2
---
 arch/riscv/boot/dts/codasip/a70x-hobgoblin.dts      | 5 +++++
 arch/riscv/configs/codasip-a70x-hobgoblin_defconfig | 1 +
 2 files changed, 6 insertions(+)

diff --git a/arch/riscv/boot/dts/codasip/a70x-hobgoblin.dts b/arch/riscv/boot/dts/codasip/a70x-hobgoblin.dts
index f26c6e0cde31..767618b3c743 100644
--- a/arch/riscv/boot/dts/codasip/a70x-hobgoblin.dts
+++ b/arch/riscv/boot/dts/codasip/a70x-hobgoblin.dts
@@ -205,4 +205,9 @@ led-0 {
 			linux,default-trigger = "heartbeat";
 		};
 	};
+
+	gpio-restart {
+		compatible = "gpio-restart";
+		gpios = <&gpio_sd 3 GPIO_ACTIVE_HIGH>;
+	};
 };
diff --git a/arch/riscv/configs/codasip-a70x-hobgoblin_defconfig b/arch/riscv/configs/codasip-a70x-hobgoblin_defconfig
index 525fb4e6c7e5..c7d97cbbf52e 100644
--- a/arch/riscv/configs/codasip-a70x-hobgoblin_defconfig
+++ b/arch/riscv/configs/codasip-a70x-hobgoblin_defconfig
@@ -148,3 +148,4 @@ CONFIG_RCU_EQS_DEBUG=y
 # CONFIG_FTRACE is not set
 # CONFIG_RUNTIME_TESTING_MENU is not set
 CONFIG_MEMTEST=y
+CONFIG_POWER_RESET_GPIO_RESTART=y
-- 
2.39.3

