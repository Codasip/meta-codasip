From ca6f74e86a646d447667a1085fd45008b06ce9b2 Mon Sep 17 00:00:00 2001
From: Stuart Menefy <stuart.menefy@codasip.com>
Date: Tue, 23 Jan 2024 17:31:16 +0000
Subject: [PATCH 09/19] hw/riscv/hobgoblin: Add FPGA SRAM block

The Hobgoblin platform has an SRAM block internal to the FPGA.

Signed-off-by: Stuart Menefy <stuart.menefy@codasip.com>
---
 hw/riscv/hobgoblin.c         | 4 ++++
 include/hw/riscv/hobgoblin.h | 1 +
 2 files changed, 5 insertions(+)

diff --git a/hw/riscv/hobgoblin.c b/hw/riscv/hobgoblin.c
index ef4fe7e030..a2dece3a25 100644
--- a/hw/riscv/hobgoblin.c
+++ b/hw/riscv/hobgoblin.c
@@ -64,6 +64,8 @@ static const memmapEntry_t memmap[] = {
         "riscv.hobgoblin.boot.rom"},
     [HOBGOBLIN_BOOT_RAM] = { 0x10400000, 0x00008000,
         "riscv.hobgoblin.boot.ram"},
+    [HOBGOBLIN_SRAM] =     { 0x20000000, 0x08000000,
+        "riscv.hobgoblin.sram"},
     [HOBGOBLIN_PLIC] =     { 0x40000000,  0x4000000, ""},
     [HOBGOBLIN_CLINT] =    { 0x60014000,     0xc000, ""},
     /*
@@ -327,6 +329,8 @@ static void hobgoblin_machine_init(MachineState *machine)
     hobgoblin_add_memory_area(system_memory, &memmap[HOBGOBLIN_MROM]);
     hobgoblin_add_memory_area(system_memory, &memmap[HOBGOBLIN_BOOT_ROM]);
     hobgoblin_add_memory_area(system_memory, &memmap[HOBGOBLIN_BOOT_RAM]);
+    /* SRAM exists on FPGA only */
+    hobgoblin_add_memory_area(system_memory, &memmap[HOBGOBLIN_SRAM]);
 
     /* add interrupt controller */
     hobgoblin_add_interrupt_controller(s, smp_cpus);
diff --git a/include/hw/riscv/hobgoblin.h b/include/hw/riscv/hobgoblin.h
index b78825c6df..aab4a80f13 100644
--- a/include/hw/riscv/hobgoblin.h
+++ b/include/hw/riscv/hobgoblin.h
@@ -44,6 +44,7 @@ enum {
     HOBGOBLIN_MROM,
     HOBGOBLIN_BOOT_ROM,
     HOBGOBLIN_BOOT_RAM,
+    HOBGOBLIN_SRAM, /* exists on FPGA only */
     HOBGOBLIN_PLIC,
     HOBGOBLIN_CLINT,
     HOBGOBLIN_UART0,
-- 
2.43.0

